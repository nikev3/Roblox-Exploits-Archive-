--[[

This code is from a simultion that i did of an old IBM mainframe in the roblox enviorment
This is the client side were it gets all the keyboard inputs to write on screen

--]]


local UIS=game:GetService("UserInputService")
local IsFrozen=false
local Shift=false
local plr= game.Players.LocalPlayer
local IBMFireServer=game.ReplicatedStorage.IBM7094.FireIBMServer
local Backspace=game.ReplicatedStorage.IBM7094.Backspace
local KeyTextLib=require(game.ReplicatedStorage.IBM7094.KeyTextLib)
local Remotes=game.ReplicatedStorage.IBM7094
local IsConnected=Instance.new("BoolValue",script)
local Config=require(Remotes.GlobalConfig)
local BackspaceInterval=Config.BackspaceHoldInterval
local IsActive=false
function TypingActivate()
	spawn(function()
		while true do
					
			if IsFrozen==false  then break end
			local Number=65
			for i=1,25 do
				
				
				
				if UIS:IsKeyDown(Enum.KeyCode[string.char(Number)]) then
					local Text=Enum.KeyCode[string.char(Number)].Name
					if not Shift then IBMFireServer:FireServer(Text:lower()) else IBMFireServer:FireServer(Text:upper()) 
					end
				 
					
					
					
					
					break
				end
				

				Number=Number+1
			end
			
			for i=1,10 do
					local TextResult,TargetInput=KeyTextLib.GetNumberKey(i)[1],KeyTextLib.GetNumberKey(i)[2]
				local ShiftText=KeyTextLib.GetNumberKey(i)[3]
				if UIS:IsKeyDown(TargetInput) then
					if not Shift then
						
					IBMFireServer:FireServer(tostring(TextResult))
						break
					else
						
						IBMFireServer:FireServer(tostring(ShiftText))
						
						break
					end
				end
				Number=Number+1
				end
			
			
			
			
			if UIS:IsKeyDown(Enum.KeyCode.Backspace) then 
				
			while UIS:IsKeyDown(Enum.KeyCode.Backspace) do
					if not UIS:IsKeyDown(Enum.KeyCode.Backspace) then break end
						Backspace:FireServer()
						wait(BackspaceInterval)
					
				end
			end
			
			
			if UIS:IsKeyDown(Enum.KeyCode.Backquote) then
				if not Shift then 
					IBMFireServer:FireServer("`")	
				else
					IBMFireServer:FireServer("~")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Tab) then
				IBMFireServer:FireServer("	")
			elseif UIS:IsKeyDown(Enum.KeyCode.RightBracket) then
				if not Shift then
					IBMFireServer:FireServer("]")
				else
					IBMFireServer:FireServer("}")
				end
				
				
				
			elseif UIS:IsKeyDown(Enum.KeyCode.LeftBracket) then
				if not Shift then
					IBMFireServer:FireServer("[")
				else
					IBMFireServer:FireServer("{")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Quote) then
				if not Shift then
					IBMFireServer:FireServer("'")
				else
					IBMFireServer:FireServer([["]])
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Semicolon) then
				if not Shift then
					IBMFireServer:FireServer(";")
				else IBMFireServer:FireServer(":")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Comma) then
				if not Shift then
					IBMFireServer:FireServer(",")
				else IBMFireServer:FireServer("<")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Period) then
				if not Shift then
					IBMFireServer:FireServer(".")
				else IBMFireServer:FireServer(">")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Slash) then
				if not Shift then
					IBMFireServer:FireServer("/")
				else IBMFireServer:FireServer("?")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Minus) then
				if not Shift then
					IBMFireServer:FireServer("-")
				else IBMFireServer:FireServer("_")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.Equals) then
				if not Shift then
					IBMFireServer:FireServer("=")
				else IBMFireServer:FireServer("+")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.BackSlash) then
				if not Shift then
					IBMFireServer:FireServer([[\]])
				else IBMFireServer:FireServer("|")
				end
			elseif UIS:IsKeyDown(Enum.KeyCode.KeypadDivide) then
				IBMFireServer:FireServer("/")
			elseif UIS:IsKeyDown(Enum.KeyCode.KeypadMultiply) then
				IBMFireServer:FireServer("*")
			elseif UIS:IsKeyDown(Enum.KeyCode.KeypadMinus) then
				IBMFireServer:FireServer("-")
			elseif UIS:IsKeyDown(Enum.KeyCode.KeypadPlus) then
				IBMFireServer:FireServer("+")
			elseif UIS:IsKeyDown(Enum.KeyCode.KeypadPeriod) then
				IBMFireServer:FireServer(".")
			end
			
			
			
			
			UIS.InputBegan:Wait()
		end
	end)
end
function DisableControls(Computer,State)
	IsFrozen=State
	local controls = require(game.Players.LocalPlayer.PlayerScripts.PlayerModule):GetControls()
	if IsFrozen then
		TypingActivate()
		workspace.CurrentCamera.CameraType=Enum.CameraType.Scriptable
		workspace.CurrentCamera.CFrame=Computer["IBM PCjr"]["PCjr Display"].Camera.CFrame
		game.StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, false)
	controls:Disable()
	else
		workspace.CurrentCamera.CameraType=Enum.CameraType.Custom
		game.StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, true)
	controls:Enable()
	end
end




local InputBegan=function(Input)
	if UIS:IsKeyDown(Enum.KeyCode.RightShift) or UIS:IsKeyDown(Enum.KeyCode.LeftShift) then
		Shift=true
	else
		Shift=false
	end
	if IsFrozen==true then
		if Input.KeyCode==Enum.KeyCode.Space then IBMFireServer:FireServer(" ")  
		elseif Input.KeyCode==Enum.KeyCode.Return then IBMFireServer:FireServer("\n") end
	end
	if Input==Enum.KeyCode.CapsLock then
		Shift=not Shift
	end
	
end
IsConnected.Value=false

local InputBeganConnection=UIS.InputBegan:Connect(InputBegan)
function ValChanged()
	if IsConnected.Value==false then
		print(false)
		InputBeganConnection:Disconnect()
	else
		print(true)
		InputBeganConnection=UIS.InputBegan:Connect(InputBegan)
	end
end
IsConnected:GetPropertyChangedSignal("Value"):Connect(ValChanged)
ValChanged()
Remotes.UseComputer.OnClientEvent:Connect(function(Computer)
	
	DisableControls(Computer,true)
	local GUI=script.Main:Clone()
	GUI.Parent=script.Parent
	GUI.Enabled=true
	IsConnected.Value=true
	local ButtonConnect=GUI.Exit.MouseButton1Click:Connect(function()
		GUI:Destroy()
		DisableControls(Computer,false)
		IsConnected.Value=false
		IBMFireServer:FireServer("","","",true)
	end)
end)



